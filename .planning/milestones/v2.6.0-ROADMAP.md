# Milestone v2.6.0: tmux Integration & Named Containers

**Status:** ✅ SHIPPED 2026-01-31
**Phases:** 30-34
**Total Plans:** 7

## Overview

The aishell project delivers isolated, reproducible Docker environments for AI coding harnesses. v2.6.0 introduces tmux integration with named containers, enabling observability for long-running AI agents through session management and multi-instance support via project-hash-based naming.

## Phases

### Phase 30: Container Utilities & Naming

**Goal**: Provide foundation utilities for container naming and Docker queries that all subsequent phases depend on.
**Depends on**: Nothing (first phase in milestone)
**Plans**: 1 plan

Plans:
- [x] 30-01: Container naming utilities and --name CLI flag

**Details:**
- Created naming.clj with 8 utility functions for container naming and Docker state queries
- Deterministic naming: aishell-{8-char-hash}-{name} with SHA-256 project path hashing
- Path normalization with fs/canonicalize for consistent hashing across symlinks
- Docker query functions: exists, running, list, remove-if-stopped, ensure-available

### Phase 31: Dockerfile & Image Build

**Goal**: Add tmux to base Docker image without increasing build time or introducing dependency conflicts.
**Depends on**: Phase 30
**Plans**: 1 plan

Plans:
- [x] 31-01: Add tmux to base image package list

**Details:**
- Added tmux to apt-get install list in templates.clj
- Maintained alphabetical package order
- Minimal image size increase (<5MB)

### Phase 32: Detached Mode & Conflict Detection

**Goal**: Enable harness commands to run in named, detached containers with tmux auto-start while preserving existing shell mode behavior.
**Depends on**: Phase 31
**Plans**: 3 plans

Plans:
- [x] 32-01: Entrypoint tmux auto-start for all container modes
- [x] 32-02: CLI --detach flag, conflict detection, named container args
- [x] 32-03: TERM validation before tmux (gap closure)

**Details:**
- All container modes auto-start inside tmux session 'main' (user override of shell-only criterion)
- gosu runs before tmux to ensure user-owned socket
- --detach/-d flag for background execution with user-friendly feedback
- Conflict detection: error for running duplicates, auto-remove stopped containers
- TERM validation with infocmp and xterm-256color fallback

### Phase 33: Attach Command

**Goal**: Provide simple CLI for reconnecting to running containers' tmux sessions.
**Depends on**: Phase 32
**Plans**: 1 plan

Plans:
- [x] 33-01: Attach command implementation and CLI integration

**Details:**
- `aishell attach --name <name>` connects to container's tmux session via docker exec
- Three-layer validation: TTY → container state → session existence
- User-friendly error messages with actionable guidance for each failure case
- p/exec for terminal takeover (not p/shell)

### Phase 34: PS Command & Polish

**Goal**: Provide project-scoped container discovery and listing.
**Depends on**: Phase 32
**Plans**: 1 plan

Plans:
- [x] 34-01: PS command implementation and CLI integration

**Details:**
- `aishell ps` lists running containers for current project filtered by project hash
- Table output with NAME (short form), STATUS, CREATED columns
- Helpful empty state message with examples

---

## Milestone Summary

**Key Decisions:**
- 8-char SHA-256 hash for container names (2^32 space, <0.02% collision at 100 projects)
- All modes auto-start inside tmux (override of shell-only criterion for consistency)
- gosu before tmux in exec chain (user-owned socket)
- infocmp for TERM validation (defensive check without image bloat)
- xterm-256color fallback (universally available in Debian)
- -d short form safe for --detach (no conflicts with harness flags)
- --rm + --detach valid in modern Docker (auto-cleanup when stopped)
- p/exec for attach terminal takeover (full TTY control)

**Issues Resolved:**
- TERM validation gap (xterm-ghostty and other custom terminals caused tmux failures)
- --name flag extraction conflict (attach command needed its own parsing)

**Issues Deferred:**
- Session discovery on attach error (show tmux ls output)
- Visual indicators for containers with active tmux clients
- `aishell clean` command for removing stopped containers
- Per-harness session naming

**Technical Debt Incurred:**
None — all phases clean with no deferred items.

---

_For current project status, see .planning/ROADMAP.md (created for next milestone)_
