# Milestone v1.2: Hardening & Edge Cases

**Status:** âœ… SHIPPED 2026-01-19
**Phases:** 11-12
**Total Plans:** 4

## Overview

Harden input validation, improve robustness for edge cases, and document known limitations. This milestone focused on defensive coding practices and security awareness.

## Phases

### Phase 11: Code Hardening

**Goal**: Eliminate edge case bugs and add defensive validation across the codebase
**Depends on**: Phase 10 (v1.1 complete)
**Plans**: 3 plans

Plans:
- [x] 11-01: Cleanup infrastructure (trap consolidation, signal handling)
- [x] 11-02: Input validation and security warnings
- [x] 11-03: Gap closure (default case handlers for unknown options)

**Details:**

Requirements addressed: VALID-01, VALID-02, VALID-03, ROBUST-01, ROBUST-02, ROBUST-03, SEC-01

Success Criteria (all verified):
1. Port mapping with IP binding (e.g., 127.0.0.1:8080:80) is accepted and passed to docker run
2. Invalid version strings (with shell metacharacters) are rejected before reaching npm/curl
3. Script handles missing HOME gracefully with fallback behavior
4. Ctrl+C during build phase exits cleanly without orphaned processes or temp files
5. Running container with --privileged or docker.sock mount prints a warning to stderr

### Phase 12: Maintenance & Documentation

**Goal**: Add update detection and document known limitations for users
**Depends on**: Phase 11
**Plans**: 1 plan

Plans:
- [x] 12-01: Dockerfile hash detection and documentation updates

**Details:**

Requirements addressed: MAINT-01, DOC-01, DOC-02

Success Criteria (all verified):
1. `aishell` warns when embedded Dockerfile differs from the hash at build time
2. README documents run.conf parsing limits (no escaped quotes, one value per line)
3. README documents safe.directory behavior and its effect on host gitconfig

---

## Milestone Summary

**Decimal Phases:** None

**Key Decisions:**

- Single trap cleanup EXIT registered at script start
- Helpers (register_cleanup, track_pid) instead of inline trap statements
- Validate versions at all entry points (parse_args, do_build, do_update)
- Defense in depth for version validation (blocklist + allowlist)
- Docker --init for zombie reaping (simpler than custom PID 1)
- Default case handlers in option-parsing case statements
- 12-char sha256 for Dockerfile hash (matches project hash pattern)
- Skip hash check gracefully for old images (backward compatibility)
- Warn-only for version mismatch (don't block users)

**Issues Resolved:**

- Trap override bugs eliminated by consolidation
- Shell injection via version flags blocked
- Zombie processes handled via --init
- Unknown options no longer silently ignored

**Issues Deferred:**

None.

**Technical Debt Incurred:**

None.

---

_For current project status, see .planning/PROJECT.md_
