---
phase: 66-global-base-image-customization
plan: 04
type: execute
wave: 4
depends_on:
  - 66-03
files_modified:
  - src/aishell/cli.clj
  - CHANGELOG.md
autonomous: true
requirements:
  - BASE-10

must_haves:
  truths:
    - "CLI version string reports 3.8.0"
    - "CHANGELOG.md has a v3.8.0 entry summarizing global base image customization"
  artifacts:
    - path: "src/aishell/cli.clj"
      provides: "Version string 3.8.0"
      contains: "\"3.8.0\""
    - path: "CHANGELOG.md"
      provides: "v3.8.0 changelog entry"
      contains: "## v3.8.0"
  key_links:
    - from: "CHANGELOG.md"
      to: "src/aishell/cli.clj"
      via: "version number consistency"
      pattern: "3.8.0"
---

<objective>
Bump version to 3.8.0 and update CHANGELOG for the Global Base Image Customization release.

Purpose: Mark the milestone as ready for users with proper versioning and change documentation.

Output: Version 3.8.0 in CLI, CHANGELOG entry.
</objective>

<execution_context>
@/home/jonasrodrigues/.claude/get-shit-done/workflows/execute-plan.md
@/home/jonasrodrigues/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/66-global-base-image-customization/66-CONTEXT.md
@src/aishell/cli.clj
@CHANGELOG.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Version bump to 3.8.0</name>
  <files>src/aishell/cli.clj</files>
  <action>
Update the version constant in `src/aishell/cli.clj`:
- Change `(def version "3.7.0")` to `(def version "3.8.0")`
- That's the only place the version string lives (it's used by print-version and print-version-json)

Also update any doc files that contain hardcoded version references (check docs/ files updated in Plan 66-03 — they should already reference the right version from their updates, but verify and bump any remaining v3.7.0 references to v3.8.0).
  </action>
  <verify>
`grep -rn "3.7.0" src/aishell/cli.clj` returns zero results.
`bb -e "(require '[aishell.cli]) (aishell.cli/print-version)"` outputs "aishell 3.8.0".
  </verify>
  <done>
Version constant is 3.8.0. `aishell --version` reports 3.8.0.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CHANGELOG entry for v3.8.0</name>
  <files>CHANGELOG.md</files>
  <action>
Add a new v3.8.0 entry at the top of CHANGELOG.md (before the existing v3.7.0 entry).

Content should summarize the Global Base Image Customization feature:

```markdown
## v3.8.0 — Global Base Image Customization

- Introduced three-tier image chain: `aishell:foundation` -> `aishell:base` -> `aishell:ext-{hash}`
- Users can customize the base image globally by creating `~/.aishell/Dockerfile`
- Base image builds lazily on first container run when global Dockerfile is detected
- Automatic cascade rebuilds: foundation change -> base rebuild -> extension rebuilds
- `aishell check` shows base image status (custom or default alias)
- `aishell setup --force` and `aishell update --force` rebuild the base image
- `aishell volumes prune` cleans up orphaned custom base images
- Project extension Dockerfiles now accept both `FROM aishell:base` and `FROM aishell:foundation`
- Removed legacy `FROM aishell:base` validation (it's now the recommended FROM line)
```

Follow existing CHANGELOG conventions (no link references per project convention from Phase 65 decision).
  </action>
  <verify>
CHANGELOG.md starts with v3.8.0 entry. Content covers the key features.
  </verify>
  <done>
CHANGELOG.md has v3.8.0 entry. Version bump is complete across all files.
  </done>
</task>

</tasks>

<verification>
1. `aishell --version` outputs "aishell 3.8.0"
2. CHANGELOG.md has v3.8.0 as the first entry
3. No remaining references to v3.7.0 in modified files (except CHANGELOG's historical entry)
</verification>

<success_criteria>
- Version 3.8.0 in CLI
- CHANGELOG entry summarizes all key features of the release
- Consistent version across all files
</success_criteria>

<output>
After completion, create `.planning/phases/66-global-base-image-customization/66-04-SUMMARY.md`
</output>
