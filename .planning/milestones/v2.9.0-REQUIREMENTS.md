# Requirements Archive: v2.9.0 tmux Opt-in & Plugin Support

**Archived:** 2026-02-03
**Status:** ✅ SHIPPED

This is the archived requirements specification for v2.9.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

## v2.9.0 Requirements

Requirements for tmux opt-in and plugin support. Each maps to roadmap phases.

### Opt-in Behavior

- [x] **TMUX-01**: `aishell build --with-tmux` enables tmux; default behavior is no tmux
- [x] **TMUX-02**: `:with-tmux` flag stored in state.edn and used by downstream commands
- [x] **TMUX-03**: Entrypoint conditionally starts tmux session (skips when disabled)
- [x] **TMUX-04**: `attach` command validates tmux is enabled and fails gracefully with helpful message when not
- [x] **TMUX-05**: Users upgrading from v2.7-2.8 see migration warning about tmux behavioral change

### Config Mounting

- [x] **CONF-01**: User's `~/.tmux.conf` mounted read-only into container when tmux is enabled
- [x] **CONF-02**: Missing `~/.tmux.conf` on host is handled gracefully (no error, just skipped)

### Plugin Management

- [x] **PLUG-01**: `tmux.plugins` list in `.aishell/config.yaml` declares plugins (format: `owner/repo`)
- [x] **PLUG-02**: TPM (tmux plugin manager) installed into harness volume at `/tools/tmux/plugins/tpm`
- [x] **PLUG-03**: Declared plugins installed non-interactively during `aishell build` / `aishell update`
- [x] **PLUG-04**: Plugin path bridging: symlink from `/tools/tmux/plugins` to `~/.tmux/plugins` in entrypoint
- [x] **PLUG-05**: TPM run command appended to tmux config at container startup
- [x] **PLUG-06**: Plugin format validated (`owner/repo` pattern) during config parsing

### Session Persistence

- [x] **PERS-01**: tmux-resurrect state directory mounted from host when enabled in config
- [x] **PERS-02**: `tmux.resurrect` section in config.yaml configures state persistence
- [x] **PERS-03**: Process restoration disabled by default (only window/pane layout restored)

### Documentation

- [x] **DOCS-01**: All user-facing CLI changes reflected in docs/ (README, ARCHITECTURE, CONFIGURATION, HARNESSES, TROUBLESHOOTING, DEVELOPMENT)

## Out of Scope

| Feature | Reason |
|---------|--------|
| Per-project tmux.conf | Global host config only; per-project adds complexity without clear value |
| Runtime plugin installation (via TPM at container start) | Slow, unreproducible; build-time is better |
| Plugin conflict resolution | Trust TPM to handle; not our domain |
| tmux theme management | User preference via their own .tmux.conf |
| Session resurrection across container restarts by default | Opt-in via resurrect config; ephemeral is the design principle |
| GUI plugin manager | Scope creep; CLI-focused tool |
| Automatic plugin updates | Version drift risk; explicit update via `aishell update` |
| Plugin installation in foundation image | Version drift, slow rebuilds; harness volume is the right layer |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| TMUX-01 | Phase 39 | Complete |
| TMUX-02 | Phase 39 | Complete |
| TMUX-03 | Phase 41 | Complete |
| TMUX-04 | Phase 43 | Complete |
| TMUX-05 | Phase 43 | Complete |
| CONF-01 | Phase 39 | Complete |
| CONF-02 | Phase 39 | Complete |
| PLUG-01 | Phase 40 | Complete |
| PLUG-02 | Phase 40 | Complete |
| PLUG-03 | Phase 40 | Complete |
| PLUG-04 | Phase 41 | Complete |
| PLUG-05 | Phase 41 | Complete |
| PLUG-06 | Phase 40 | Complete |
| PERS-01 | Phase 42 | Complete |
| PERS-02 | Phase 42 | Complete |
| PERS-03 | Phase 42 | Complete |
| DOCS-01 | Phase 43 | Complete |

---

## Milestone Summary

**Shipped:** 17 of 17 v2.9.0 requirements
**Adjusted:** None — all requirements shipped as originally defined
**Dropped:** None

---
*Archived: 2026-02-03 as part of v2.9.0 milestone completion*
