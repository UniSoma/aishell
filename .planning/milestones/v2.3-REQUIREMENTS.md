# Requirements Archive: v2.3.0 Safe AI Context Protection

**Archived:** 2026-01-24
**Status:** SHIPPED

This is the archived requirements specification for v2.3.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: Agentic Harness Sandbox

**Defined:** 2026-01-22
**Core Value:** Run agentic AI harnesses in isolated, reproducible environments without polluting the host system.

## v2.1 Requirements

Requirements for v2.1 Safe AI Context Protection. Extends existing security warnings to project directory contents.

### Core Detection Framework

- [x] **FRMW-01**: Detection system supports severity tiers (high/medium/low) for different finding types
- [x] **FRMW-02**: Warnings display during `aishell` / `aishell claude` / `aishell opencode` before container runs
- [x] **FRMW-03**: Warnings are advisory only (never block) consistent with existing security warning pattern

### Environment Files

- [x] **ENVF-01**: Warn (medium) when .env files exist in project directory
- [x] **ENVF-02**: Warn (medium) when .env.* variant files exist (.env.local, .env.production, .envrc)
- [x] **ENVF-03**: Inform (low) when .env.example/.env.sample exist (template files, lower risk)

### Private Keys & Certificates (Content-Aware)

- [x] **PKEY-01**: Warn (high) when files contain private key markers — DELEGATED TO GITLEAKS
- [x] **PKEY-02**: Warn (high) when common SSH key files exist (id_rsa, id_dsa, id_ed25519, id_ecdsa, *.ppk)
- [x] **PKEY-03**: Warn (high) when key container files exist (*.p12, *.pfx, *.jks, *.keystore)
- [x] **PKEY-04**: Warn (medium) when *.pem or *.key files exist (may be certs, not just private keys)

### Cloud Credentials

- [x] **CLOD-01**: Warn (high) when GCP service account files detected — DELEGATED TO GITLEAKS
- [x] **CLOD-02**: Warn (high) when application_default_credentials.json exists
- [x] **CLOD-03**: Warn (high) when terraform.tfstate* files exist (can contain plaintext secrets)
- [x] **CLOD-04**: Warn (medium) when kubeconfig or .kube/config patterns detected

### Package Manager & Tool Credentials

- [x] **PKGM-01**: Warn (high) when .npmrc with authToken detected — DELEGATED TO GITLEAKS
- [x] **PKGM-02**: Warn (high) when .pypirc exists
- [x] **PKGM-03**: Warn (high) when .netrc exists
- [x] **PKGM-04**: Warn (medium) when .yarnrc.yml, .docker/config.json, .terraformrc, credentials.tfrc.json exist

### Application Secrets

- [x] **ASEC-01**: Warn (high) when Rails master.key or credentials*.yml.enc exist
- [x] **ASEC-02**: Warn (medium) when secret.*, secrets.*, vault.*, token.*, apikey.*, private.* files exist
- [x] **ASEC-03**: Warn (medium) when database credential files exist (.pgpass, .my.cnf, database.yml)

### Context Awareness

- [x] **CTXT-01**: Extra warning when high-severity files exist but are NOT in .gitignore (likely accidental)
- [x] **CTXT-02**: Warnings indicate whether file is in mounted project directory vs additional mounts — DEFERRED (full paths provide sufficient context)

### Configuration

- [x] **CONF-01**: Sensitive file patterns configurable via .aishell/config.yaml
- [x] **CONF-02**: Custom patterns are additive by default (extend, don't replace defaults)
- [x] **CONF-03**: Explicit allowlist supported to suppress specific false positives
- [x] **CONF-04**: Config parsing is safe (no YAML tags that instantiate objects)

## Future Requirements

Deferred to v2.4 or later. Tracked but not in current roadmap.

### Advanced Secret Detection

- **SECR-01**: Built-in detection of AWS access key patterns in file contents
- **SECR-02**: Built-in detection of GitHub token patterns in file contents
- **SECR-03**: Built-in detection of generic high-entropy strings (API key heuristics)
- ✓ **SECR-04**: Gitleaks integration for deep scanning — IMPLEMENTED IN v2.3.0

### Audit Command

- **AUDT-01**: `aishell audit` command for pre-run security check
- **AUDT-02**: Audit command produces structured report (JSON/YAML)
- **AUDT-03**: Audit command supports CI/CD mode (exit code on findings)

### Strict Mode

- **STRM-01**: Optional strict mode that blocks on high-severity findings
- **STRM-02**: Strict mode configurable via CLI flag or config

## Out of Scope

Explicitly excluded. Documented to prevent scope creep.

| Feature | Reason |
|---------|--------|
| Blocking by default | Advisory pattern only - never block, just inform (per v2.0 decision) |
| PII detection (SSN, credit card) | High false positive rate, enterprise feature, defer to v3+ |
| Git history scanning | High complexity, significant performance impact |
| Network egress monitoring | Out of scope for container startup - would require runtime hooks |
| Secret encryption/vaulting | Not harness's responsibility - integrates with external tools |
| Windows-specific credential paths | Windows support deferred indefinitely |
| Home directory scanning | Warns only about project dir and explicit mounts, not ~/.aws etc. unless mounted |
| Full AWS/GCP/Azure SDK credential chain | Too complex; focus on files in project context |

## Traceability

Which phases cover which requirements. Updated during roadmap creation.

| Requirement | Phase | Status |
|-------------|-------|--------|
| FRMW-01 | Phase 19 | Complete |
| FRMW-02 | Phase 19 | Complete |
| FRMW-03 | Phase 19 | Complete |
| ENVF-01 | Phase 20 | Complete |
| ENVF-02 | Phase 20 | Complete |
| ENVF-03 | Phase 20 | Complete |
| PKEY-01 | Gitleaks | Complete (delegated) |
| PKEY-02 | Phase 20 | Complete |
| PKEY-03 | Phase 20 | Complete |
| PKEY-04 | Phase 20 | Complete |
| CLOD-01 | Gitleaks | Complete (delegated) |
| CLOD-02 | Phase 21 | Complete |
| CLOD-03 | Phase 21 | Complete |
| CLOD-04 | Phase 21 | Complete |
| PKGM-01 | Gitleaks | Complete (delegated) |
| PKGM-02 | Phase 21 | Complete |
| PKGM-03 | Phase 21 | Complete |
| PKGM-04 | Phase 21 | Complete |
| ASEC-01 | Phase 21 | Complete |
| ASEC-02 | Phase 21 | Complete |
| ASEC-03 | Phase 21 | Complete |
| CTXT-01 | Phase 23 | Complete |
| CTXT-02 | Deferred | Deferred (low value) |
| CONF-01 | Phase 23 | Complete |
| CONF-02 | Phase 23 | Complete |
| CONF-03 | Phase 23 | Complete |
| CONF-04 | Phase 23 | Complete |

**Coverage:**
- v2.1/v2.3 requirements: 27 total
- Satisfied: 23 (85%)
- Delegated to Gitleaks: 3 (covered by alternative)
- Deferred: 1 (low value)

---

## Milestone Summary

**Shipped:** 23 of 27 v2.1 requirements
**Adjusted:** 3 requirements delegated to Gitleaks integration (PKEY-01, CLOD-01, PKGM-01)
**Dropped:** 1 requirement deemed low value (CTXT-02 - mount source indication)

---
*Archived: 2026-01-24 as part of v2.3.0 milestone completion*
