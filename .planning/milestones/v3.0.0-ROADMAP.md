# Milestone v3.0.0: Docker-native Attach

**Status:** SHIPPED 2026-02-06
**Phases:** 46-52
**Total Plans:** 9

## Overview

Remove tmux from containers entirely, simplify attach to docker exec, adjust CLI semantics so window management belongs on the host.

## Phases

### Phase 46: Foundation Image Cleanup
**Goal**: tmux binary removed from foundation image
**Depends on**: Nothing (starts new milestone)
**Plans**: 1 plan

Plans:
- [x] 46-01: Remove tmux installation from Dockerfile template and verify image build

**Details:**
Removed tmux binary installation, ARG declaration, and global config from foundation Dockerfile template. First step in v3.0.0 tmux elimination.

### Phase 47: State & Config Schema Cleanup
**Goal**: tmux flags and options removed from aishell's configuration surface
**Depends on**: Phase 46
**Plans**: 1 plan

Plans:
- [x] 47-01: Remove tmux from CLI spec, help text, handler logic, state schema, and config validation

**Details:**
Removed --with-tmux flag, tmux state keys, and config validation functions. Bumped state schema to v3.0.0. Deleted ~85 lines of tmux validation logic (parse-resurrect-config, validate-tmux-config, validate-plugin-format).

### Phase 48: Docker Run Arguments Cleanup
**Goal**: All tmux-related mounts and environment variables removed from container runtime
**Depends on**: Phase 47
**Plans**: 2 plans

Plans:
- [x] 48-01: Delete tmux functions and cond-> blocks from docker/run.clj, rename skip-tmux to skip-interactive
- [x] 48-02: Delete tmux functions from volume.clj, clean up hash calculation and volume population

**Details:**
Deleted 4 tmux-related functions from docker/run.clj, removed WITH_TMUX env var and tmux mounts. Removed TPM installation from volume population. Renamed skip-tmux to skip-interactive.

### Phase 49: Entrypoint Simplification
**Goal**: Entrypoint becomes simple exec gosu without tmux conditional logic
**Depends on**: Phase 48
**Plans**: 1 plan

Plans:
- [x] 49-01: Delete tmux dead code from entrypoint-script and update comments in templates.clj

**Details:**
Removed ~80 lines of dead tmux conditional logic from entrypoint script (plugin bridging, config injection, resurrect, startup wrapper). Single execution path: validate environment then exec gosu directly.

### Phase 50: Attach Command Rewrite
**Goal**: Attach simplified to docker exec -it bash
**Depends on**: Phase 49
**Plans**: 1 plan

Plans:
- [x] 50-01: Rewrite attach.clj and CLI dispatch for docker exec bash with positional argument

**Details:**
Replaced tmux session management with simple docker exec bash. Removed 5 tmux-specific functions, added single attach-to-container function. Changed CLI syntax from --name flag to positional argument.

### Phase 51: CLI Semantics Update
**Goal**: Default container naming and detach flag removal
**Depends on**: Phase 50
**Plans**: 1 plan

Plans:
- [x] 51-01: Remove detach flag, extend --name to shell mode, update help text

**Details:**
Removed all --detach/-d flag handling. Extended --name extraction to shell mode so `aishell --name foo` works. Simplified docker run logic by removing detached vs foreground branching.

### Phase 52: Documentation Update
**Goal**: All v3.0.0 CLI changes reflected across documentation
**Depends on**: Phase 51
**Plans**: 2 plans

Plans:
- [x] 52-01: Update README, ARCHITECTURE, and CONFIGURATION for v3.0.0 (remove tmux/detach)
- [x] 52-02: Update HARNESSES and TROUBLESHOOTING for v3.0.0 (remove tmux/detach)

**Details:**
Updated all 6 documentation files. Removed tmux Architecture section (~90 lines), tmux Issues section (~160 lines), Detached Mode section. Simplified entrypoint flow from 10 to 5 steps. Replaced tmux workflow docs with Multi-Container Workflow.

---

## Milestone Summary

**Key Decisions:**
- Remove tmux entirely (not just opt-in) — window management belongs on host
- Positional argument for attach (`aishell attach <name>`) — simpler UX
- Remove --detach flag entirely — always-foreground model
- Rename skip-tmux to skip-interactive — broader parameter purpose
- Single entrypoint execution path — no conditional branching
- State schema bump to v3.0.0 — reflects removal of tmux keys
- Pure deletion refactor approach — 7 phases, each removing one layer

**Issues Resolved:**
- tmux complexity removed from codebase (~1,155 lines deleted across source and docs)
- Entrypoint simplified from ~197 to ~117 lines
- Attach command simplified from tmux session management to docker exec

**Issues Deferred:**
- None — v3.0.0 was a focused removal/simplification milestone

**Technical Debt Incurred:**
- migration.clj still has v2.9.0 tmux migration warnings (harmless but outdated)
- v2.7.0 :dockerfile-hash backward compat key still written in code

---

_For current project status, see .planning/ROADMAP.md_
