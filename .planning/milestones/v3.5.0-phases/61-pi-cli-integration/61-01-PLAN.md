---
phase: 61-pi-cli-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/aishell/docker/templates.clj
autonomous: true
requirements: [HARNESS-02, HARNESS-04, HARNESS-06, HARNESS-07, HARNESS-08, HARNESS-09]

must_haves:
  truths:
    - "Pi alias is available inside the container shell when pi is installed with harness_args configured"
    - "`aishell pi` launches pi coding agent inside the container"
    - "`aishell pi --print hello` passes arguments through to pi"
    - "Pi config directory (~/.pi/) is mounted from host into the container"
    - "`aishell check` shows pi installation status and version"
    - "`aishell --help` lists the pi command when pi is installed"
  artifacts:
    - path: "src/aishell/docker/templates.clj"
      provides: "Entrypoint alias loop includes HARNESS_ALIAS_PI"
      contains: "HARNESS_ALIAS_PI"
  key_links:
    - from: "src/aishell/docker/run.clj:build-harness-alias-env-args"
      to: "src/aishell/docker/templates.clj:entrypoint-script"
      via: "HARNESS_ALIAS_PI env var passed to container, entrypoint iterates and creates bash alias"
      pattern: "HARNESS_ALIAS_PI"
---

<objective>
Add HARNESS_ALIAS_PI to the entrypoint.sh alias generation loop, completing pi coding agent CLI integration.

Purpose: Phase 60 wired pi across the entire CLI (dispatch, config mounts, check, help, pass-through args, alias env var), but the entrypoint.sh for-loop that creates bash aliases inside the container only iterates over CLAUDE, OPENCODE, CODEX, and GEMINI -- missing PI. This single fix completes all 6 Phase 61 requirements.

Output: Updated entrypoint-script in templates.clj with HARNESS_ALIAS_PI in the alias loop.
</objective>

<execution_context>
@/home/jonasrodrigues/.claude/get-shit-done/workflows/execute-plan.md
@/home/jonasrodrigues/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/60-pi-build-infrastructure/60-02-SUMMARY.md

Key context: Phase 60-02 added the `HARNESS_ALIAS_PI` env var to `build-harness-alias-env-args` in `docker/run.clj` (line 193), but the entrypoint.sh for-loop in `templates.clj` (line 173) only iterates over `HARNESS_ALIAS_CLAUDE HARNESS_ALIAS_OPENCODE HARNESS_ALIAS_CODEX HARNESS_ALIAS_GEMINI`. The fix is adding `HARNESS_ALIAS_PI` to that loop.

All other HARNESS-02/04/06/07/08 requirements were already implemented in Phase 60-02:
- cli.clj: dispatch "pi" -> run/run-container, installed-harnesses, print-help, pass-through args
- run.clj: verify-harness-available "pi", container-cmd "pi", ensure-harness-volume :with-pi
- docker/run.clj: .pi config mount, PI_* env var passthrough, alias env args
- check.clj: Pi in check-harnesses display vector
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add HARNESS_ALIAS_PI to entrypoint alias generation loop</name>
  <files>src/aishell/docker/templates.clj</files>
  <action>
In `src/aishell/docker/templates.clj`, find the entrypoint-script string's for-loop that generates harness aliases:

```
for var in HARNESS_ALIAS_CLAUDE HARNESS_ALIAS_OPENCODE HARNESS_ALIAS_CODEX HARNESS_ALIAS_GEMINI; do
```

Add `HARNESS_ALIAS_PI` to the end of the list:

```
for var in HARNESS_ALIAS_CLAUDE HARNESS_ALIAS_OPENCODE HARNESS_ALIAS_CODEX HARNESS_ALIAS_GEMINI HARNESS_ALIAS_PI; do
```

This ensures the entrypoint creates a `pi` bash alias inside the container when the HARNESS_ALIAS_PI env var is set (which docker/run.clj already handles via build-harness-alias-env-args).

IMPORTANT: This is a string within a Clojure def. The backslashes are escaped for Clojure string embedding. Match the exact existing content including escapes.
  </action>
  <verify>
1. `grep -n "HARNESS_ALIAS_PI" src/aishell/docker/templates.clj` — should match in BOTH the entrypoint for-loop AND confirm it appears
2. `grep -c "HARNESS_ALIAS_" src/aishell/docker/templates.clj` — should show the for-loop line containing all 5 harness aliases
3. `bb -e '(require (quote [aishell.docker.templates :as t])) (println (re-find #"HARNESS_ALIAS_CLAUDE.*HARNESS_ALIAS_PI" t/entrypoint-script))'` — should print the for-loop var list confirming PI is present
4. `bb -e '(require (quote [aishell.docker.templates :as t])) (println "OK")'` — confirms templates.clj loads without syntax errors
  </verify>
  <done>
The entrypoint.sh for-loop iterates over all 5 harness alias env vars: CLAUDE, OPENCODE, CODEX, GEMINI, PI. When a user runs `aishell setup --with-pi` and enters the container shell, the `pi` command alias is available (matching the behavior of other harness aliases).
  </done>
</task>

</tasks>

<verification>
1. `grep "HARNESS_ALIAS_PI" src/aishell/docker/templates.clj` — PI in entrypoint for-loop
2. `grep "HARNESS_ALIAS_PI" src/aishell/docker/run.clj` — PI env var passed (from Phase 60)
3. `grep ":with-pi" src/aishell/cli.clj` — pi dispatch and help (from Phase 60)
4. `grep ":with-pi" src/aishell/run.clj` — pi container launch (from Phase 60)
5. `grep ":with-pi" src/aishell/check.clj` — pi in check display (from Phase 60)
6. `grep '".pi"' src/aishell/docker/run.clj` — pi config mount (from Phase 60)
7. `bb -e '(require (quote [aishell.docker.templates :as t])) (println "OK")'` — templates loads
</verification>

<success_criteria>
- HARNESS_ALIAS_PI is in the entrypoint for-loop alongside the other 4 harness aliases
- All 6 Phase 61 requirement IDs (HARNESS-02, 04, 06, 07, 08, 09) are satisfied
- templates.clj loads without errors in Babashka
</success_criteria>

<output>
After completion, create `.planning/phases/61-pi-cli-integration/61-01-SUMMARY.md`
</output>
