---
phase: 45-documentation-updates
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/TROUBLESHOOTING.md
  - docs/ARCHITECTURE.md
autonomous: true

must_haves:
  truths:
    - "TROUBLESHOOTING.md has a new section for 'gitleaks command not found' pointing to --with-gitleaks"
    - "TROUBLESHOOTING.md existing Gitleaks section notes it applies only when Gitleaks is installed"
    - "ARCHITECTURE.md describes Gitleaks as opt-in via --with-gitleaks (not --without-gitleaks)"
    - "ARCHITECTURE.md state.edn example shows :with-gitleaks false as default"
  artifacts:
    - path: "docs/TROUBLESHOOTING.md"
      provides: "Updated troubleshooting with opt-in Gitleaks context"
      contains: "--with-gitleaks"
    - path: "docs/ARCHITECTURE.md"
      provides: "Updated architecture reference with opt-in Gitleaks semantics"
      contains: "--with-gitleaks"
  key_links:
    - from: "docs/TROUBLESHOOTING.md"
      to: "docs/CONFIGURATION.md"
      via: "Reference to build flag documentation"
      pattern: "--with-gitleaks"
---

<objective>
Update docs/TROUBLESHOOTING.md and docs/ARCHITECTURE.md to reflect Gitleaks opt-in default from Phase 44.

Purpose: Supporting docs must be consistent with the primary docs (README, CONFIGURATION). TROUBLESHOOTING needs a new "command not found" section and context on existing Gitleaks issues. ARCHITECTURE needs internal reference updates.
Output: Updated docs/TROUBLESHOOTING.md and docs/ARCHITECTURE.md with consistent opt-in messaging.
</objective>

<execution_context>
@/home/jonasrodrigues/.claude/get-shit-done/workflows/execute-plan.md
@/home/jonasrodrigues/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/45-documentation-updates/45-RESEARCH.md
@docs/TROUBLESHOOTING.md
@docs/ARCHITECTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update docs/TROUBLESHOOTING.md with opt-in Gitleaks context</name>
  <files>docs/TROUBLESHOOTING.md</files>
  <action>
Make 2 changes to docs/TROUBLESHOOTING.md.

1. **Add new troubleshooting section BEFORE the existing "Gitleaks scan takes too long" section (before line 738).** Insert:

   ```markdown
   ### Symptom: "gitleaks" command not found or missing from `aishell --help`

   **Cause:** Gitleaks is opt-in and was not installed during build. By default, aishell does NOT install Gitleaks.

   **Resolution:**

   1. **Rebuild with Gitleaks:**
      ```bash
      aishell setup --with-claude --with-gitleaks
      ```

   2. **Verify installation:**
      ```bash
      aishell
      gitleaks version
      # Should show: gitleaks version
      ```

   3. **Check build state:**
      ```bash
      cat ~/.aishell/state.edn
      # Should show :with-gitleaks true
      ```

   4. **Alternative:** If you don't need deep content scanning, aishell's built-in filename-based sensitive file detection works without Gitleaks. No action needed.

   ```

2. **Add context note to the existing "Gitleaks scan takes too long" section (line 738).** After the heading line `### Symptom: "Gitleaks scan takes too long" on large repositories`, add:

   ```markdown

   **Note:** This section applies only when Gitleaks is installed (built with `--with-gitleaks`). If you don't have Gitleaks installed, see the section above.
   ```

**Important:** Preserve all existing content and formatting. Do NOT change the `---` separator at line 774 or any content after it.
  </action>
  <verify>
Run: `grep -n "command not found\|not installed\|opt-in\|--with-gitleaks" docs/TROUBLESHOOTING.md` — should show the new section and context note.
Run: `grep -c "with-gitleaks" docs/TROUBLESHOOTING.md` — should return at least 3 matches (new section heading context, rebuild command, existing section note).
  </verify>
  <done>TROUBLESHOOTING.md has new "command not found" section pointing users to --with-gitleaks, and existing Gitleaks section notes it applies only when installed.</done>
</task>

<task type="auto">
  <name>Task 2: Update docs/ARCHITECTURE.md Gitleaks references to opt-in semantics</name>
  <files>docs/ARCHITECTURE.md</files>
  <action>
Make 4 updates to docs/ARCHITECTURE.md.

1. **Line 60 — Design principles:** Change from:
   ```
   6. **Security Layers:** Detection (filename patterns) + Gitleaks (content scanning) before launch
   ```
   To:
   ```
   6. **Security Layers:** Detection (filename patterns) + Gitleaks (opt-in content scanning) before launch
   ```

2. **Line 78 — Foundation image contents:** Change from:
   ```
   - Gitleaks binary (optional, via `--without-gitleaks`)
   ```
   To:
   ```
   - Gitleaks binary (opt-in, via `--with-gitleaks`)
   ```

3. **Line 285 — Build diagram:** Change from:
   ```
   │ - Install Node.js, Babashka, Gosu, Gitleaks  │
   ```
   To:
   ```
   │ - Install Node.js, Babashka, Gosu             │
   │ - Install Gitleaks (if --with-gitleaks)        │
   ```
   Note: Adjust the box border character alignment to match the existing diagram width.

4. **Line 509 — state.edn example:** Change from:
   ```
    :with-gitleaks true                     ; boolean: Gitleaks installed?
   ```
   To:
   ```
    :with-gitleaks false                    ; boolean: Gitleaks installed? (opt-in, default false)
   ```

5. **Lines 470-473 — Gitleaks layer description:** Change from:
   ```
   2. **Gitleaks layer (aishell.gitleaks.*):** Content-based secret scanning
      - Slower; runs on-demand via `aishell gitleaks dir .`
      - Warns when scans exceed 7 days old
      - Advisory only; never blocks execution
   ```
   To:
   ```
   2. **Gitleaks layer (aishell.gitleaks.*):** Content-based secret scanning (opt-in via `--with-gitleaks`)
      - Requires `--with-gitleaks` build flag; not available by default
      - Slower; runs on-demand via `aishell gitleaks dir .`
      - Warns when scans exceed 7 days old
      - Advisory only; never blocks execution
   ```

6. **Lines 592-594 — FAQ section:** Change from:
   ```
   **Why two-layer security (detection + gitleaks)?**

   - **Speed vs thoroughness:** Detection runs instantly; Gitleaks scans comprehensively
   ```
   To:
   ```
   **Why two-layer security (detection + gitleaks)?**

   - **Speed vs thoroughness:** Detection runs instantly; Gitleaks (when installed) scans comprehensively
   ```

**Important:** Preserve all ASCII art diagram alignment. Do NOT change any section headings. Do NOT change module table entries at lines 460-461.
  </action>
  <verify>
Run: `grep -n "without-gitleaks" docs/ARCHITECTURE.md` — should return no matches.
Run: `grep -n "with-gitleaks" docs/ARCHITECTURE.md` — should return matches at lines 78, 285, 470, 509.
Run: `grep -n "opt-in" docs/ARCHITECTURE.md` — should return at least 3 matches (design principles, foundation contents, gitleaks layer, state.edn).
  </verify>
  <done>ARCHITECTURE.md contains no references to --without-gitleaks, describes Gitleaks as opt-in throughout, and state.edn example shows default false.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `grep -rn "without-gitleaks" docs/TROUBLESHOOTING.md docs/ARCHITECTURE.md` — zero matches
2. `grep -rn "with-gitleaks" docs/TROUBLESHOOTING.md docs/ARCHITECTURE.md` — matches in both files
3. `grep -rn "opt-in" docs/ARCHITECTURE.md` — at least 3 matches
4. HARNESSES.md has no Gitleaks references (confirmed in research, no changes needed — DOCS-04 satisfied)
5. No broken Markdown formatting
</verification>

<success_criteria>
- TROUBLESHOOTING.md covers "command not found" issue with --with-gitleaks resolution (DOCS-03)
- TROUBLESHOOTING.md existing Gitleaks section notes conditional applicability
- ARCHITECTURE.md consistently uses opt-in language with --with-gitleaks
- HARNESSES.md confirmed clean — no Gitleaks mentions exist (DOCS-04)
- No references to --without-gitleaks remain
</success_criteria>

<output>
After completion, create `.planning/phases/45-documentation-updates/45-02-SUMMARY.md`
</output>
