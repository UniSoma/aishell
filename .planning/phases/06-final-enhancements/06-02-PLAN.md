---
phase: 06-final-enhancements
plan: 02
type: execute
wave: 2
depends_on: [06-01]
files_modified:
  - aishell
autonomous: true

must_haves:
  truths:
    - "Container shell prompt shows abbreviated path (not full absolute path)"
    - "Claude Code runs with --dangerously-skip-permissions by default"
    - "User can opt-out of permission skip via AISHELL_SKIP_PERMISSIONS=false"
  artifacts:
    - path: "aishell"
      provides: "UX improvements for prompt and permissions"
      contains: "PROMPT_DIRTRIM"
  key_links:
    - from: "write_bashrc"
      to: "PS1"
      via: "PROMPT_DIRTRIM export"
      pattern: "PROMPT_DIRTRIM"
    - from: "claude dispatch"
      to: "docker run"
      via: "--dangerously-skip-permissions flag"
      pattern: "dangerously-skip-permissions"
---

<objective>
Improve container UX with concise prompt and auto-skip permissions

Purpose: Better user experience in container shell and safer defaults for sandboxed environment
Output: aishell with PROMPT_DIRTRIM in bashrc and --dangerously-skip-permissions for claude
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-final-enhancements/06-RESEARCH.md
@.planning/phases/06-final-enhancements/06-01-SUMMARY.md
@aishell
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add PROMPT_DIRTRIM to bashrc for concise prompt</name>
  <files>aishell</files>
  <action>
Modify write_bashrc() function to add PROMPT_DIRTRIM before the PS1 export.

In the bashrc.aishell heredoc content, add after the comment line "# Custom prompt":

```bash
# Limit directory depth in prompt (shows .../parent/current instead of full path)
export PROMPT_DIRTRIM=2
```

Result: The prompt will show `.../projects/harness` instead of `/home/user/projects/harness`.

Per RESEARCH.md:
- PROMPT_DIRTRIM=2 shows last 2 path components
- Works with `\w` (lowercase) in PS1
- Native Bash 4+ feature, no custom functions needed
  </action>
  <verify>Run `grep -A2 'PROMPT_DIRTRIM' aishell` to confirm the export is present in the bashrc heredoc</verify>
  <done>bashrc.aishell heredoc includes PROMPT_DIRTRIM=2 for concise directory display</done>
</task>

<task type="auto">
  <name>Task 2: Add --dangerously-skip-permissions for Claude with opt-out</name>
  <files>aishell</files>
  <action>
Modify the claude case in the dispatch logic (in main() function, around line 697).

Change from:
```bash
claude)
    exec docker run "${docker_args[@]}" "$IMAGE_TO_RUN" claude "${HARNESS_ARGS[@]}"
    ;;
```

To:
```bash
claude)
    local claude_args=()
    # Default: skip permissions (container is the sandbox)
    # Opt-out: AISHELL_SKIP_PERMISSIONS=false
    if [[ "${AISHELL_SKIP_PERMISSIONS:-true}" != "false" ]]; then
        claude_args+=(--dangerously-skip-permissions)
    fi
    exec docker run "${docker_args[@]}" "$IMAGE_TO_RUN" claude "${claude_args[@]}" "${HARNESS_ARGS[@]}"
    ;;
```

Also update usage() to document the environment variable:

Add after the Options section, a new Environment Variables section:
```
Environment Variables:
    AISHELL_SKIP_PERMISSIONS   Set to 'false' to require permission prompts in Claude
                               (default: true, permissions auto-skipped in container)
```

Per RESEARCH.md:
- Docker's official Claude sandbox also defaults to --dangerously-skip-permissions
- Container itself is the security boundary
- AISHELL_SKIP_PERMISSIONS=false provides opt-out for users who want prompts
  </action>
  <verify>
Run `grep -A5 'case.*claude\)' aishell` to confirm the permission skip logic is present.
Run `./aishell --help` to confirm Environment Variables section appears.
  </verify>
  <done>Claude runs with --dangerously-skip-permissions by default, user can opt-out via AISHELL_SKIP_PERMISSIONS=false</done>
</task>

</tasks>

<verification>
1. `grep PROMPT_DIRTRIM aishell` returns the export line in bashrc heredoc
2. `grep dangerously-skip-permissions aishell` returns the flag in claude dispatch
3. `./aishell --help` shows AISHELL_SKIP_PERMISSIONS documentation
</verification>

<success_criteria>
- UX-01: Container shell prompt uses PROMPT_DIRTRIM=2 for abbreviated paths
- UX-02: Claude Code runs with --dangerously-skip-permissions by default
- Opt-out works via AISHELL_SKIP_PERMISSIONS=false environment variable
</success_criteria>

<output>
After completion, create `.planning/phases/06-final-enhancements/06-02-SUMMARY.md`
</output>
