---
phase: 18-distribution
plan: 03
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - aishell
  - README.md
  - CHANGELOG.md
autonomous: true

must_haves:
  truths:
    - "Legacy bash aishell script is removed from repo root"
    - "README documents v2.0 Babashka version with no bash references"
    - "README shows correct installation command for v2.0"
    - "CHANGELOG has v2.0 entry with BREAKING CHANGES section"
  artifacts:
    - path: "README.md"
      provides: "v2.0 documentation"
      contains: "Babashka"
    - path: "CHANGELOG.md"
      provides: "v2.0 release notes"
      contains: "[2.0.0]"
  key_links:
    - from: "README.md"
      to: "install.sh"
      via: "curl|bash command"
      pattern: "curl.*install.sh"
---

<objective>
Remove legacy bash implementation and update documentation for v2.0 release.

Purpose: Clean break from v1.x bash version to v2.0 Babashka version with clear migration guidance.
Output: Removed legacy files, updated README.md and CHANGELOG.md
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-distribution/18-CONTEXT.md
@.planning/phases/18-distribution/18-01-SUMMARY.md

@README.md
@CHANGELOG.md
@aishell (legacy bash script to be removed)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove legacy bash aishell script</name>
  <files>aishell</files>
  <action>
    Remove the legacy bash aishell script from repo root:

    ```bash
    git rm aishell
    ```

    This removes the 51KB bash script that was the v1.x implementation.
    The v2.0 implementation lives in src/aishell/ and will be distributed as uberscript.

    Keep aishell.clj (the dev entry script) - it's still needed for development.

    Note: Do NOT commit yet - wait until all changes in this plan are ready.
  </action>
  <verify>ls aishell 2>/dev/null || echo "aishell removed"</verify>
  <done>Legacy bash aishell script removed from repo root</done>
</task>

<task type="auto">
  <name>Task 2: Update README.md for v2.0</name>
  <files>README.md</files>
  <action>
    Rewrite README.md focused on v2.0 Babashka version. Use the existing structure as a guide but update for v2.0.

    **Key changes:**

    1. **Requirements section:**
       - Add Babashka as requirement: "Babashka (https://babashka.org)"
       - Keep: Linux, Docker Engine
       - Note: macOS support available

    2. **Installation section:**
       - Update curl command to point to new install.sh
       - Add note about Babashka prerequisite
       - Keep PATH instructions

    3. **Usage section:**
       - Update build examples to use new flag syntax:
         - `aishell build --with-claude` (same)
         - `aishell build --with-claude=1.0.0` (new single-flag syntax)
       - Keep run examples the same

    4. **Configuration section:**
       - Change from `.aishell/run.conf` to `.aishell/config.yaml`
       - Update example to YAML format:
         ```yaml
         mounts:
           - /path/to/data
           - source: $HOME/.secrets
             target: /secrets
         env:
           DATABASE_URL: passthrough
           MY_VAR: literal_value
         ports:
           - "3000:3000"
           - "8080:80"
         docker_args: "--memory=4g --cpus=2"
         pre_start: "redis-server --daemonize yes"
         ```

    5. **Remove run.conf Limitations section:**
       - YAML doesn't have the same parsing limitations
       - Remove the entire section about escaped quotes, multi-line values, etc.

    6. **Keep unchanged:**
       - Features section (still accurate)
       - Git safe.directory section (still applies)
       - Environment Variables section (still applies)
       - Base Image Contents section (still applies)
       - License section

    Do NOT reference bash implementation or v1.x anywhere.
  </action>
  <verify>
    grep -q 'Babashka' README.md
    grep -q 'config.yaml' README.md
    ! grep -q 'run.conf' README.md
  </verify>
  <done>
    README.md updated for v2.0:
    - Babashka listed as requirement
    - Installation points to new installer
    - Config examples use YAML format
    - No bash/v1.x references
  </done>
</task>

<task type="auto">
  <name>Task 3: Update CHANGELOG.md with v2.0 entry</name>
  <files>CHANGELOG.md</files>
  <action>
    Add v2.0.0 entry at the top of CHANGELOG.md (after the header, before [1.2.0]).

    Format following existing changelog style:

    ```markdown
    ## [2.0.0] - 2026-01-21

    ### BREAKING CHANGES

    - **Babashka required**: aishell now requires Babashka (https://babashka.org) to run
    - **Config format changed**: `.aishell/run.conf` (bash) replaced by `.aishell/config.yaml` (YAML)
    - **State format changed**: Build state stored in `~/.aishell/state.edn` (EDN format)

    ### Added

    - Complete rewrite in Clojure Babashka for cross-platform support
    - YAML configuration with richer data structures
    - Single-flag version syntax: `--with-claude=1.0.0` (replaces `--with-claude --claude-version=1.0.0`)
    - Levenshtein-based command suggestions for typos
    - XDG Base Directory support for state files
    - Colored output with NO_COLOR and TERM detection

    ### Changed

    - Distribution via uberscript (single .clj file) instead of bash script
    - Installation location unchanged: `~/.local/bin/aishell`

    ### Migration

    1. Uninstall old version: `rm ~/.local/bin/aishell`
    2. Install Babashka: https://babashka.org
    3. Install new version: `curl -fsSL https://raw.githubusercontent.com/UniSoma/aishell/main/install.sh | bash`
    4. Migrate config (if using):
       - Convert `.aishell/run.conf` to `.aishell/config.yaml`
       - See README.md for YAML format
    5. `.aishell/Dockerfile` remains compatible, no changes needed
    ```

    Keep the existing v1.2.0, v1.1.0, and v1.0.0 entries below.
  </action>
  <verify>
    grep -q '\[2.0.0\]' CHANGELOG.md
    grep -q 'BREAKING CHANGES' CHANGELOG.md
    grep -q 'Migration' CHANGELOG.md
  </verify>
  <done>
    CHANGELOG.md has v2.0.0 entry with:
    - BREAKING CHANGES section listing Babashka requirement and config format change
    - Added section with new features
    - Migration section with step-by-step instructions
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Legacy aishell bash script is removed (git rm)
2. README.md documents v2.0 with Babashka requirement
3. README.md uses YAML config examples (not run.conf)
4. CHANGELOG.md has v2.0.0 entry with breaking changes and migration guide
5. No references to bash implementation or run.conf in README
</verification>

<success_criteria>
- Clean repo with no legacy v1.x files
- Documentation accurately reflects v2.0 Babashka version
- Users have clear migration path from v1.x to v2.0
- CHANGELOG follows Keep a Changelog format
</success_criteria>

<output>
After completion, create `.planning/phases/18-distribution/18-03-SUMMARY.md`
</output>
