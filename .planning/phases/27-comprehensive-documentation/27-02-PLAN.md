---
phase: 27-comprehensive-documentation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/HARNESSES.md
autonomous: true

must_haves:
  truths:
    - "docs/HARNESSES.md documents all four harnesses (Claude, OpenCode, Codex, Gemini)"
    - "Each harness section includes setup, authentication, and usage"
    - "Comparison table helps users choose between harnesses"
    - "Authentication differences between OAuth and API key are clear"
  artifacts:
    - path: "docs/HARNESSES.md"
      provides: "Complete harness documentation with setup and usage guides"
      min_lines: 200
  key_links:
    - from: "docs/HARNESSES.md"
      to: "README.md"
      via: "authentication reference"
      pattern: "API.*(key|KEY)|OAuth"
---

<objective>
Create comprehensive per-harness documentation covering setup, authentication, and usage for all four AI harnesses.

Purpose: Enable users to set up and use any supported harness with clear, harness-specific guidance.

Output:
- docs/HARNESSES.md with per-harness sections and comparison table
</objective>

<execution_context>
@/home/jonasrodrigues/.claude/get-shit-done/workflows/execute-plan.md
@/home/jonasrodrigues/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-comprehensive-documentation/27-CONTEXT.md
@.planning/phases/27-comprehensive-documentation/27-RESEARCH.md
@README.md
@src/aishell/docker/run.clj
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs/HARNESSES.md</name>
  <files>docs/HARNESSES.md</files>
  <action>
Create comprehensive harness documentation with:

1. **Header section:**
   - Title: "aishell Harness Guide"
   - Brief intro explaining what harnesses are
   - "Last updated: v2.4.0"

2. **Harness Comparison Table:**
   | Feature | Claude Code | OpenCode | Codex CLI | Gemini CLI |
   |---------|-------------|----------|-----------|------------|
   | Provider | Anthropic | Multiple | OpenAI | Google |
   | Auth Methods | OAuth, API Key | Per-provider | OAuth, API Key | OAuth, API Key |
   | Container Auth | Copy-paste URL | Standard | Device code | Auth on host first |
   | Vertex AI | No | Yes | No | Yes |
   | Config Dir | ~/.claude | ~/.config/opencode | ~/.codex | ~/.gemini |
   | Best For | Autonomous coding | Multi-model flexibility | ChatGPT integration | Gemini models |

3. **Per-Harness Sections:**
   For each harness (Claude Code, OpenCode, Codex CLI, Gemini CLI):

   a. **Overview** - What it is, provider, key capabilities

   b. **Installation** - Build command with version pinning
      ```bash
      aishell build --with-claude
      aishell build --with-claude=2.0.22
      ```

   c. **Authentication**
      - OAuth method (container-specific guidance)
      - API key method (env vars)
      - Container-specific nuances

   d. **Usage**
      - Basic: `aishell claude`
      - With arguments: `aishell claude --help`
      - Default args via config.yaml

   e. **Environment Variables**
      Table of relevant env vars for that harness

   f. **Tips & Best Practices**
      - Model selection (if applicable)
      - Session handling
      - Common patterns

4. **Claude Code section specifics:**
   - OAuth works well in containers (copy-paste URL)
   - ANTHROPIC_API_KEY for API key auth
   - Config dir: ~/.claude

5. **OpenCode section specifics:**
   - Supports multiple providers
   - Provider-specific env vars
   - Config dirs: ~/.config/opencode, ~/.local/share/opencode

6. **Codex CLI section specifics:**
   - OPENAI_API_KEY for login
   - CODEX_API_KEY only works with `codex exec`
   - Device code auth: `codex login --device-auth`
   - Config dir: ~/.codex

7. **Gemini CLI section specifics:**
   - IMPORTANT: OAuth requires host authentication first
   - GEMINI_API_KEY or GOOGLE_API_KEY
   - Vertex AI: GOOGLE_APPLICATION_CREDENTIALS
   - Config dir: ~/.gemini

8. **Multiple Harnesses section:**
   - Building with multiple: `aishell build --with-claude --with-opencode`
   - Switching between harnesses in same session
   - Shared environment variables

Keep tone: task-focused, setup-heavy. Include actual commands users will run.
  </action>
  <verify>File exists at docs/HARNESSES.md with sections for all four harnesses and comparison table</verify>
  <done>Harness guide documents all four harnesses with setup, authentication, and usage sections plus comparison table</done>
</task>

</tasks>

<verification>
After completing the task:

1. Check docs/HARNESSES.md exists:
   ```bash
   ls -la docs/HARNESSES.md
   ```

2. Verify all four harnesses are documented:
   ```bash
   grep -E '^## (Claude|OpenCode|Codex|Gemini)' docs/HARNESSES.md
   ```

3. Verify comparison table exists:
   ```bash
   grep -A 10 'Comparison' docs/HARNESSES.md | head -15
   ```

4. Verify authentication sections:
   ```bash
   grep -c 'Authentication' docs/HARNESSES.md
   ```
</verification>

<success_criteria>
- docs/HARNESSES.md exists with 200+ lines
- Document contains comparison table
- All four harnesses have dedicated sections
- Each harness section covers: installation, authentication, usage
- OAuth vs API key differences are clear for each harness
- Container-specific authentication nuances are documented
</success_criteria>

<output>
After completion, create `.planning/phases/27-comprehensive-documentation/27-02-SUMMARY.md`
</output>
