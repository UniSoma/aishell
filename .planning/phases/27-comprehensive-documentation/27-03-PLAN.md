---
phase: 27-comprehensive-documentation
plan: 03
type: execute
wave: 2
depends_on: ["27-01", "27-02"]
files_modified:
  - docs/TROUBLESHOOTING.md
  - docs/DEVELOPMENT.md
  - README.md
autonomous: true

must_haves:
  truths:
    - "docs/TROUBLESHOOTING.md organizes issues by symptom"
    - "docs/TROUBLESHOOTING.md covers common CLI errors and credential issues"
    - "docs/DEVELOPMENT.md includes a checklist for adding new harnesses"
    - "README.md links to docs/ folder for additional documentation"
  artifacts:
    - path: "docs/TROUBLESHOOTING.md"
      provides: "Common issues and solutions organized by symptom"
      min_lines: 100
    - path: "docs/DEVELOPMENT.md"
      provides: "Guide for extending aishell with new harnesses"
      min_lines: 80
  key_links:
    - from: "README.md"
      to: "docs/"
      via: "documentation links"
      pattern: "docs/(ARCHITECTURE|CONFIGURATION|HARNESSES|TROUBLESHOOTING|DEVELOPMENT)"
---

<objective>
Complete the documentation suite with troubleshooting guide, development guide, and README documentation links.

Purpose: Enable users to self-serve on common issues and enable developers to extend aishell.

Output:
- docs/TROUBLESHOOTING.md with symptom-organized issue resolution
- docs/DEVELOPMENT.md with new harness checklist
- Updated README.md with links to docs/ folder
</objective>

<execution_context>
@/home/jonasrodrigues/.claude/get-shit-done/workflows/execute-plan.md
@/home/jonasrodrigues/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-comprehensive-documentation/27-CONTEXT.md
@.planning/phases/27-comprehensive-documentation/27-RESEARCH.md
@.planning/phases/27-comprehensive-documentation/27-01-SUMMARY.md
@.planning/phases/27-comprehensive-documentation/27-02-SUMMARY.md
@README.md
@src/aishell/cli.clj
@src/aishell/docker/templates.clj
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs/TROUBLESHOOTING.md</name>
  <files>docs/TROUBLESHOOTING.md</files>
  <action>
Create troubleshooting documentation organized by symptom:

1. **Header section:**
   - Title: "aishell Troubleshooting"
   - How to use this guide (find symptom, follow resolution)
   - "Last updated: v2.4.0"

2. **Quick Diagnostics section:**
   Useful commands for gathering info:
   ```bash
   aishell --version
   docker info
   docker images | grep aishell
   cat ~/.aishell/state.edn
   ```

3. **Build Issues:**
   - "Docker not found" - Install Docker, ensure daemon running
   - "Permission denied" - Add user to docker group or use sudo
   - "Image build fails" - Check Dockerfile syntax in .aishell/Dockerfile
   - "Version not found" - Verify version format, check npm registry

4. **Container Issues:**
   - "Container exits immediately" - Check pre_start command, view logs
   - "File not found in container" - Verify mount paths, check config.yaml
   - "Permission denied on mounted files" - UID/GID mismatch guidance
   - "git safe.directory errors" - Explain why this happens, how entrypoint handles it

5. **Authentication Issues:**
   - "Claude: API key not working" - Check ANTHROPIC_API_KEY is set
   - "Codex: Login fails" - Use device code auth in containers
   - "Gemini: OAuth fails in container" - Authenticate on host first
   - "Credentials not persisting" - Verify config dir is mounted

6. **Sensitive File Detection:**
   - "False positive on test file" - Add to allowlist with reason
   - "Custom pattern not matching" - Check glob syntax
   - "Gitleaks scan takes too long" - Exclude large directories

7. **Network Issues:**
   - "Port not accessible" - Verify port format in config.yaml
   - "Cannot reach external services" - Check docker network mode

8. **Getting Help:**
   - GitHub issues link
   - How to report a bug (include state.edn, error output)

Keep tone: diagnostic, step-by-step. Start with symptom, explain cause, provide solution.
  </action>
  <verify>File exists at docs/TROUBLESHOOTING.md with symptom-organized sections</verify>
  <done>Troubleshooting guide covers common issues organized by symptom with clear solutions</done>
</task>

<task type="auto">
  <name>Task 2: Create docs/DEVELOPMENT.md</name>
  <files>docs/DEVELOPMENT.md</files>
  <action>
Create development guide for extending aishell:

1. **Header section:**
   - Title: "aishell Development Guide"
   - Target audience: developers adding features or harnesses
   - "Last updated: v2.4.0"

2. **Development Setup:**
   - Clone repo
   - Install Babashka
   - Run from source: `bb -m aishell.core build --with-claude`

3. **Project Structure:**
   Brief overview (reference ARCHITECTURE.md for details):
   ```
   src/aishell/
   ├── cli.clj           # Command parsing
   ├── config.clj        # Configuration
   ├── run.clj           # Container execution
   ├── docker/
   │   ├── build.clj     # Image building
   │   ├── run.clj       # Docker commands
   │   └── templates.clj # Dockerfile generation
   └── detection/        # Sensitive file detection
   ```

4. **Adding a New Harness - Checklist:**

   **Step 1: Dockerfile template (docker/templates.clj)**
   - [ ] Add ARG for harness enablement: `WITH_{HARNESS}`
   - [ ] Add ARG for version: `{HARNESS}_VERSION`
   - [ ] Add npm global install in RUN block
   - [ ] Follow existing patterns (claude, codex, gemini)

   **Step 2: Build flags (docker/build.clj)**
   - [ ] Add `--with-{harness}` flag to CLI spec
   - [ ] Add `--{harness}-version` flag (or use `=VERSION` syntax)
   - [ ] Add to state.edn tracking

   **Step 3: Config mounts (docker/run.clj)**
   - [ ] Add config directory mount (~/.{harness})
   - [ ] Add to `harness-mounts` function
   - [ ] Test mount works in container

   **Step 4: Environment variables (docker/run.clj)**
   - [ ] Add API key env var to `env-passthrough-keys`
   - [ ] Document any additional env vars

   **Step 5: CLI dispatch (cli.clj)**
   - [ ] Add harness to `harness-commands` set
   - [ ] Add to help text
   - [ ] Test argument passthrough

   **Step 6: Documentation**
   - [ ] Add to README.md usage examples
   - [ ] Add to docs/HARNESSES.md
   - [ ] Add authentication instructions

5. **Testing Locally:**
   ```bash
   # Build with new harness
   bb -m aishell.core build --with-{harness}

   # Test harness runs
   bb -m aishell.core {harness} --help

   # Test config mounting
   ls ~/.{harness}  # after running once
   ```

6. **Code Style:**
   - Follow existing patterns
   - Use Clojure idioms
   - Add docstrings to functions

7. **Submitting Changes:**
   - Fork repo
   - Create feature branch
   - Submit PR with description

Keep tone: practical checklist-style. Make it easy to follow step-by-step.
  </action>
  <verify>File exists at docs/DEVELOPMENT.md with "Adding a New Harness" checklist</verify>
  <done>Development guide includes step-by-step checklist for adding new harnesses</done>
</task>

<task type="auto">
  <name>Task 3: Update README.md with documentation links</name>
  <files>README.md</files>
  <action>
Add a "Documentation" section to README.md linking to the docs/ folder.

Insert after the "Features" section (before "Why aishell?"):

```markdown
## Documentation

For detailed documentation, see the [docs/](docs/) folder:

- **[Architecture](docs/ARCHITECTURE.md)** - System design, data flow, and codebase structure
- **[Configuration](docs/CONFIGURATION.md)** - Complete config.yaml reference with examples
- **[Harnesses](docs/HARNESSES.md)** - Setup and usage guide for each AI harness
- **[Troubleshooting](docs/TROUBLESHOOTING.md)** - Common issues and solutions
- **[Development](docs/DEVELOPMENT.md)** - Guide for adding new harnesses
```

Do NOT modify any other sections of README.md. Only add the Documentation section.
  </action>
  <verify>README.md contains "## Documentation" section with links to all 5 docs files</verify>
  <done>README.md links to docs/ folder with descriptions of each document</done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Check all docs exist:
   ```bash
   ls -la docs/
   ```

2. Verify TROUBLESHOOTING.md has symptom sections:
   ```bash
   grep -E '^## |^### ' docs/TROUBLESHOOTING.md
   ```

3. Verify DEVELOPMENT.md has harness checklist:
   ```bash
   grep -A 20 'Adding a New Harness' docs/DEVELOPMENT.md
   ```

4. Verify README.md has documentation section:
   ```bash
   grep -A 10 '## Documentation' README.md
   ```

5. Verify all doc links are valid:
   ```bash
   for f in ARCHITECTURE CONFIGURATION HARNESSES TROUBLESHOOTING DEVELOPMENT; do
     test -f "docs/$f.md" && echo "OK: $f" || echo "MISSING: $f"
   done
   ```
</verification>

<success_criteria>
- docs/TROUBLESHOOTING.md exists with 100+ lines
- Troubleshooting is organized by symptom (build, container, auth, detection, network)
- docs/DEVELOPMENT.md exists with 80+ lines
- Development guide includes "Adding a New Harness" checklist with checkboxes
- README.md contains ## Documentation section
- README.md links to all 5 documentation files
- All documentation links in README.md are valid paths
</success_criteria>

<output>
After completion, create `.planning/phases/27-comprehensive-documentation/27-03-SUMMARY.md`
</output>
