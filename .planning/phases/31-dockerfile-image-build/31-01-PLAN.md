---
phase: 31-dockerfile-image-build
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/aishell/docker/templates.clj]
autonomous: true

must_haves:
  truths:
    - "tmux is available inside the aishell container"
    - "tmux -V reports a valid version (3.3a expected)"
    - "Image size increase is under 5MB"
    - "Build succeeds without dependency conflicts or warnings"
  artifacts:
    - path: "src/aishell/docker/templates.clj"
      provides: "Base Dockerfile with tmux in package list"
      contains: "tmux"
  key_links:
    - from: "src/aishell/docker/templates.clj"
      to: "Debian apt-get RUN instruction"
      via: "tmux added alphabetically between sudo and tree in package list"
      pattern: "sudo .*tmux .*tree"
---

<objective>
Add tmux to the base Docker image package list so it is available inside containers for session management.

Purpose: tmux is required by Phase 32 (Detached Mode) to wrap harness commands in persistent sessions that users can attach/detach from.
Output: Updated templates.clj with tmux in the apt-get package list.
</objective>

<execution_context>
@/home/jonasrodrigues/.claude/get-shit-done/workflows/execute-plan.md
@/home/jonasrodrigues/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/aishell/docker/templates.clj
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tmux to base image package list</name>
  <files>src/aishell/docker/templates.clj</files>
  <action>
In `src/aishell/docker/templates.clj`, add `tmux \\` to the apt-get install package list, alphabetically between `sudo \\` and `tree \\`.

The current package list (lines 35-51) has:
```
    sudo \\
    tree \\
```

Change to:
```
    sudo \\
    tmux \\
    tree \\
```

This is the ONLY change needed. Do not modify any other part of the file. Do not add a separate RUN instruction. Do not add version pinning.
  </action>
  <verify>
1. `grep -n "tmux" src/aishell/docker/templates.clj` shows tmux in the package list
2. `bb -e '(require (quote [aishell.docker.templates])) (println (re-find #"sudo.*tmux.*tree" aishell.docker.templates/base-dockerfile))'` confirms tmux is between sudo and tree
3. Visually confirm the backslash escaping is correct (matching existing pattern)
  </verify>
  <done>
tmux appears in the apt-get package list in templates.clj, alphabetically sorted between sudo and tree, with correct backslash escaping matching the existing pattern.
  </done>
</task>

</tasks>

<verification>
1. `grep "tmux" src/aishell/docker/templates.clj` â€” tmux appears in package list
2. Package list remains alphabetically sorted (sudo < tmux < tree)
3. Backslash line continuation is correct (`tmux \\`)
4. No other changes to the file
</verification>

<success_criteria>
- templates.clj contains tmux in the apt-get install package list
- Package list maintains alphabetical order
- File has correct Clojure string escaping (double backslash for line continuation)
</success_criteria>

<output>
After completion, create `.planning/phases/31-dockerfile-image-build/31-01-SUMMARY.md`
</output>
