---
phase: 26-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [README.md]
autonomous: true

must_haves:
  truths:
    - "README shows `aishell codex` and `aishell gemini` in usage examples"
    - "README documents authentication methods (OAuth and API key) for each harness"
    - "README lists all environment variables with harness association"
    - "Build examples include --with-codex and --with-gemini flags"
  artifacts:
    - path: "README.md"
      provides: "Complete multi-harness documentation"
      contains: "aishell codex"
  key_links:
    - from: "README.md"
      to: "src/aishell/docker/run.clj"
      via: "api-key-vars list"
      pattern: "CODEX_API_KEY|GEMINI_API_KEY|GOOGLE_API_KEY"
---

<objective>
Update README.md to document Codex CLI and Gemini CLI support

Purpose: Users need documentation to discover and use the new aishell codex and aishell gemini commands, understand authentication options, and know which environment variables are supported.

Output: Updated README.md with:
- Build and run examples for codex/gemini
- Authentication section with balanced OAuth/API key guidance
- Complete environment variables table organized by purpose
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/26-documentation/26-CONTEXT.md
@.planning/phases/26-documentation/26-RESEARCH.md
@README.md
@src/aishell/docker/run.clj (lines 149-166 for api-key-vars)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update build and run examples with codex/gemini commands</name>
  <files>README.md</files>
  <action>
Update the "Build an image" section to include:
- `aishell build --with-codex`
- `aishell build --with-gemini`
- `aishell build --with-claude --with-opencode --with-codex --with-gemini` (all harnesses example)
- Version pinning example: `aishell build --with-codex=0.1.2025062501`

Update the "Run harnesses" section to include:
- `aishell codex` command
- `aishell gemini` command
- Update the pass arguments example to include codex/gemini variants

Update the Features bullet point to reflect 4 harnesses instead of 2. Currently says "(Claude Code, OpenCode)" - update to include Codex CLI and Gemini CLI.

Follow existing README formatting exactly (code blocks, comment style, spacing).
  </action>
  <verify>
grep -E "aishell (codex|gemini)" README.md
grep -E "--with-(codex|gemini)" README.md
  </verify>
  <done>README contains aishell codex, aishell gemini, --with-codex, and --with-gemini examples</done>
</task>

<task type="auto">
  <name>Task 2: Add authentication section documenting auth methods per harness</name>
  <files>README.md</files>
  <action>
Add a new "## Authentication" section after "## Environment Variables" (or before it if that flows better).

Per RESEARCH.md and CONTEXT.md, present BOTH OAuth and API key options equally - do not favor one over the other.

Document for each harness:

**Claude Code:**
- OAuth: Copy-paste URL flow works from within container
- API key: Set ANTHROPIC_API_KEY

**Codex CLI:**
- OAuth: Use `codex login --device-auth` for headless/container environments
- API key: Set OPENAI_API_KEY for login, CODEX_API_KEY only works with `codex exec` mode

**Gemini CLI:**
- OAuth: Must authenticate on host first (gemini has no device code flow per GitHub issue #1696), then credentials are mounted from ~/.gemini
- API key: Set GEMINI_API_KEY or GOOGLE_API_KEY

**OpenCode:**
- Note that config directories (~/.config/opencode, ~/.local/share/opencode) are mounted

Include the important note that config directories (~/.claude, ~/.codex, ~/.gemini) are mounted from host, so credentials persist between container sessions.

Follow existing README section formatting (## headers, code blocks, bullet points).
  </action>
  <verify>
grep -c "## Authentication" README.md
grep -E "device-auth|ANTHROPIC_API_KEY|GEMINI_API_KEY" README.md
  </verify>
  <done>Authentication section exists with OAuth and API key options documented for each harness</done>
</task>

<task type="auto">
  <name>Task 3: Update Environment Variables section with complete harness-specific table</name>
  <files>README.md</files>
  <action>
Replace the current minimal Environment Variables section (only has AISHELL_SKIP_PERMISSIONS) with a comprehensive table.

Reference src/aishell/docker/run.clj api-key-vars list (lines 149-166) for the authoritative list:
- ANTHROPIC_API_KEY
- OPENAI_API_KEY
- CODEX_API_KEY
- GEMINI_API_KEY
- GOOGLE_API_KEY
- GROQ_API_KEY
- GITHUB_TOKEN
- AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_REGION, AWS_PROFILE
- AZURE_OPENAI_API_KEY, AZURE_OPENAI_ENDPOINT
- GOOGLE_CLOUD_PROJECT, GOOGLE_CLOUD_LOCATION, GOOGLE_APPLICATION_CREDENTIALS

Organize the table by category per RESEARCH.md pattern:
1. Harness-Specific Keys (Claude, Codex, Gemini, OpenCode related)
2. Cloud Provider Credentials (GCP, AWS, Azure)
3. Other (GITHUB_TOKEN, AISHELL_SKIP_PERMISSIONS)

Include notes column explaining which harnesses use which variables.

Format as markdown table matching README's existing style.
  </action>
  <verify>
grep -E "CODEX_API_KEY|GEMINI_API_KEY|GOOGLE_APPLICATION_CREDENTIALS" README.md
grep -c "|" README.md  # Should have table rows
  </verify>
  <done>Environment Variables section contains complete table with all passthrough variables organized by category</done>
</task>

</tasks>

<verification>
After all tasks:

1. Verify DOCS-01 (commands documented):
```bash
grep "aishell codex" README.md && grep "aishell gemini" README.md
```

2. Verify DOCS-02 (auth methods documented):
```bash
grep -E "OAuth|API [Kk]ey|device-auth|ANTHROPIC_API_KEY" README.md
```

3. Verify DOCS-03 (env vars documented):
```bash
grep -E "CODEX_API_KEY|GEMINI_API_KEY|GOOGLE_API_KEY|GOOGLE_APPLICATION_CREDENTIALS" README.md
```

4. Verify README renders correctly:
```bash
# Check for broken markdown (unclosed code blocks, malformed tables)
cat README.md | head -100
```
</verification>

<success_criteria>
- [ ] README shows `aishell codex` and `aishell gemini` in Run harnesses section
- [ ] README shows `--with-codex` and `--with-gemini` in Build section
- [ ] README has Authentication section with OAuth + API key for each harness
- [ ] README has Environment Variables table with all api-key-vars from run.clj
- [ ] README maintains consistent formatting throughout
- [ ] Features section reflects 4 harnesses (Claude, OpenCode, Codex, Gemini)
</success_criteria>

<output>
After completion, create `.planning/phases/26-documentation/26-01-SUMMARY.md`
</output>
