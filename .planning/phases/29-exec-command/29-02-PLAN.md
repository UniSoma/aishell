---
phase: 29-exec-command
plan: 02
type: execute
wave: 2
depends_on: ["29-01"]
files_modified:
  - README.md
  - docs/TROUBLESHOOTING.md
autonomous: true

must_haves:
  truths:
    - "User can find exec command usage in README.md"
    - "User can find exec troubleshooting tips in TROUBLESHOOTING.md"
  artifacts:
    - path: "README.md"
      provides: "exec command documentation in features and examples"
      contains: "aishell exec"
    - path: "docs/TROUBLESHOOTING.md"
      provides: "exec-related troubleshooting entries"
      contains: "exec"
  key_links:
    - from: "README.md"
      to: "docs/TROUBLESHOOTING.md"
      via: "cross-reference for exec issues"
      pattern: "Troubleshooting"
---

<objective>
Document the `aishell exec` command in README.md and add troubleshooting entries.

Purpose: Ensure users can discover and correctly use the exec command, and find help when issues arise.

Output: Updated README.md with exec examples and TROUBLESHOOTING.md with exec-specific issues.
</objective>

<execution_context>
@/home/jonasrodrigues/.claude/get-shit-done/workflows/execute-plan.md
@/home/jonasrodrigues/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/29-exec-command/29-01-SUMMARY.md

# Files to update
@README.md
@docs/TROUBLESHOOTING.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update README.md with exec command</name>
  <files>README.md</files>
  <action>
Update README.md to document the exec command:

1. **Add to Features list** (after "Gitleaks integration"):
```markdown
- **One-off commands** - Run single commands in container with `aishell exec`
```

2. **Add exec examples** in the Examples section or create dedicated section after existing examples:
```markdown
### One-off Commands

Run commands in the container without entering interactive shell:

```bash
# List files in container
aishell exec ls -la

# Run a build command
aishell exec npm install

# Check node version
aishell exec node --version

# Use with pipes
echo "hello" | aishell exec cat
cat package.json | aishell exec jq '.scripts'
```

**Note:** The exec command uses the same mounts and environment from your config.yaml, but skips pre-start hooks and sensitive file detection for fast execution.
```

3. **Update Quick Start** if there's a command reference section to include:
```bash
aishell exec <command>   # Run one-off command
```

Keep changes minimal and consistent with existing documentation style (no emojis, concise, example-driven).
  </action>
  <verify>
Read README.md and confirm:
1. Features list includes "One-off commands" entry
2. Examples section includes exec usage examples
3. Piping example is documented
4. Note about skipping detection/pre-start is present
  </verify>
  <done>
README.md documents exec command in features and provides usage examples including piping.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update TROUBLESHOOTING.md with exec issues</name>
  <files>docs/TROUBLESHOOTING.md</files>
  <action>
Add a new section for exec command troubleshooting:

```markdown
## Exec Command Issues

### "the input device is not a TTY"

**Symptom:** Running `aishell exec` in a script or CI produces this Docker error.

**Cause:** This should not happen - aishell auto-detects TTY and omits the `-t` flag when stdin is not a terminal.

**Solution:**
1. Ensure you're using the latest version of aishell
2. If issue persists, report it as a bug

### Piped input not working

**Symptom:** `echo "test" | aishell exec cat` produces no output.

**Cause:** TTY detection may be incorrectly identifying stdin as a terminal.

**Solution:**
1. Verify the pipe is correctly formed
2. Try: `echo "test" | aishell exec sh -c 'cat'`

### Exit code not propagated

**Symptom:** `aishell exec false; echo $?` returns 0 instead of 1.

**Cause:** Exit code propagation issue.

**Solution:**
1. Check that you're using the command correctly: `aishell exec <command>`
2. Verify with: `aishell exec sh -c 'exit 42'; echo $?` (should show 42)

### Command not found in container

**Symptom:** `aishell exec mycommand` fails with "command not found".

**Cause:** The command is not installed in the base image or your project extension.

**Solution:**
1. Use full path: `aishell exec /usr/bin/mycommand`
2. Add the tool to your `.aishell/Dockerfile` extension
3. Run interactive shell to debug: `aishell` then check `which mycommand`
```

Place this section appropriately (after existing command-specific sections, before general issues).
  </action>
  <verify>
Read docs/TROUBLESHOOTING.md and confirm:
1. "Exec Command Issues" section exists
2. TTY error troubleshooting is documented
3. Piped input troubleshooting is documented
4. Exit code troubleshooting is documented
5. Command not found troubleshooting is documented
  </verify>
  <done>
TROUBLESHOOTING.md has dedicated section for exec command issues covering TTY, piping, exit codes, and command availability.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **README check:**
```bash
grep -c "aishell exec" README.md
# Should return >= 3 (feature line, example(s), note)
```

2. **TROUBLESHOOTING check:**
```bash
grep -c "exec" docs/TROUBLESHOOTING.md
# Should return >= 5 (section header, multiple entries)
```

3. **Documentation consistency:**
- No emojis added
- Style matches existing documentation
- Examples are practical and testable
</verification>

<success_criteria>
1. README.md features list includes exec command
2. README.md has exec usage examples with piping
3. TROUBLESHOOTING.md has exec-specific section
4. TTY error troubleshooting documented
5. Exit code propagation troubleshooting documented
6. Documentation style consistent with existing content
</success_criteria>

<output>
After completion, create `.planning/phases/29-exec-command/29-02-SUMMARY.md`
</output>
