---
phase: 03-harness-integration
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "aishell claude launches Claude Code with working config"
    - "aishell opencode launches OpenCode with working config"
    - "aishell enters interactive shell"
    - "All 7 HARNESS requirements verified"
  artifacts: []
  key_links: []
---

<objective>
Verify complete harness integration end-to-end

Purpose: Human verification that Claude Code and OpenCode work correctly with mounted configurations and API keys. This confirms the phase is complete before moving to Phase 4.

Output: Verified phase with all HARNESS requirements confirmed
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/03-harness-integration/03-01-SUMMARY.md
@.planning/phases/03-harness-integration/03-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build full image and verify harness availability</name>
  <files></files>
  <action>
Build the complete image with both harnesses and verify binaries are accessible:

1. Build image with both harnesses:
   ```bash
   cd /home/jonasrodrigues/projects/harness
   ./aishell --with-claude --with-opencode -v
   # This will build then enter shell
   ```

2. Inside container, verify:
   ```bash
   which claude
   which opencode
   claude --version
   opencode --version
   exit
   ```

3. Test subcommand invocation (version check only, no interactive session):
   ```bash
   ./aishell claude --version
   ./aishell opencode --version
   ```
  </action>
  <verify>
All version commands succeed without error. Binaries are found at expected paths.
  </verify>
  <done>
HARNESS-06 (Claude Code installed) and HARNESS-07 (OpenCode installed) verified.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete harness integration: subcommand invocation, config mounting, API key passthrough</what-built>
  <how-to-verify>
**Prerequisites:**
- Ensure you have at least one harness config on host (Claude Code: ~/.claude or ~/.claude.json, OpenCode: ~/.config/opencode)
- Have at least one API key set (e.g., ANTHROPIC_API_KEY or OPENAI_API_KEY)

**Test 1: Shell mode (HARNESS-03)**
```bash
cd /home/jonasrodrigues/projects/harness
./aishell --with-claude --with-opencode
# Inside container:
echo "Shell works!"
exit
```
Expected: Enters shell, prompt shows [aishell], can run commands, exit works

**Test 2: Claude Code with config (HARNESS-01, HARNESS-04)**
```bash
./aishell claude
# OR if Claude needs authentication:
./aishell claude --version
```
Expected: Claude Code starts OR shows version. If you have ~/.claude mounted, settings should be visible.

**Test 3: OpenCode with config (HARNESS-02, HARNESS-05)**
```bash
./aishell opencode
# OR if OpenCode needs authentication:
./aishell opencode --version
```
Expected: OpenCode starts OR shows version. If you have ~/.config/opencode mounted, settings should be visible.

**Test 4: Verify config directories are mounted**
```bash
./aishell
# Inside container:
ls -la ~/.claude 2>/dev/null && echo "Claude config mounted" || echo "No Claude config"
ls -la ~/.config/opencode 2>/dev/null && echo "OpenCode config mounted" || echo "No OpenCode config"
exit
```
Expected: Config directories that exist on host should be visible in container

**Test 5: Verify API key passthrough**
```bash
# Set a test key on host
export TEST_API_KEY="test123"
export ANTHROPIC_API_KEY="$TEST_API_KEY"
./aishell
# Inside container:
echo $ANTHROPIC_API_KEY
exit
```
Expected: Should show "test123" (the value from host)

**Optional: Full harness session**
If you have working API credentials, try starting a full harness session:
```bash
./aishell claude
# Try a simple prompt
```
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass, or describe any issues found.
  </resume-signal>
</task>

</tasks>

<verification>
Requirements checklist:
- [ ] HARNESS-01: User can run Claude Code with `aishell claude`
- [ ] HARNESS-02: User can run OpenCode with `aishell opencode`
- [ ] HARNESS-03: User can enter shell with `aishell`
- [ ] HARNESS-04: Claude Code config (~/.claude, ~/.claude.json) mounted
- [ ] HARNESS-05: OpenCode config (~/.config/opencode) mounted
- [ ] HARNESS-06: Claude Code installed and runnable in container
- [ ] HARNESS-07: OpenCode installed and runnable in container
</verification>

<success_criteria>
- All HARNESS-* requirements verified as working
- Human confirms harnesses launch correctly
- Config directories accessible inside container
- API keys pass through from host environment
- Phase 3 ready to be marked complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-harness-integration/03-03-SUMMARY.md`
</output>
